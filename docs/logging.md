# Система логирования

## Обзор

Система логирования в проекте `crypto_bot` предназначена для отслеживания всех важных событий и операций, происходящих в приложении. Она обеспечивает структурированное хранение логов, ротацию файлов логов и различные уровни детализации.

## Особенности

- **Многоуровневое логирование**: DEBUG, INFO, WARNING, ERROR, CRITICAL
- **Ротация логов**: автоматическое архивирование и создание новых файлов
- **Структурированное логирование**: использование JSON формата для логирования операций
- **Контекстное логирование**: возможность добавления контекстной информации к сообщениям
- **Измерение производительности**: автоматическое измерение времени выполнения функций
- **Декораторы**: удобные декораторы для логирования операций и измерения времени

## Файлы логов

Система создает следующие файлы логов:

- `logs/app.log`: основной журнал событий приложения
- `logs/debug.log`: детальная отладочная информация
- `logs/error.log`: ошибки и исключения
- `logs/operations.json`: структурированные записи о выполненных операциях

## Использование

### Инициализация

Система логирования должна быть инициализирована один раз в начале работы приложения:

```python
from src.utils import setup_logging

# Настраиваем логирование
setup_logging()
```

### Получение логгера

```python
from src.utils import get_logger

# Получаем логгер для модуля
logger = get_logger(__name__)

# Используем логгер
logger.debug("Отладочная информация")
logger.info("Информационное сообщение")
logger.warning("Предупреждение")
logger.error("Сообщение об ошибке")
logger.critical("Критическая ошибка")
```

### Контекстный логгер

Контекстный логгер позволяет добавлять дополнительную информацию ко всем сообщениям:

```python
from src.utils import get_contextual_logger

# Создаем логгер с контекстом
logger = get_contextual_logger(__name__, component="data_fetcher", exchange="binance")

# Все сообщения будут содержать информацию о компоненте и бирже
logger.info("Запуск получения данных")

# Добавляем дополнительный контекст
order_logger = logger.with_context(order_id="12345", symbol="BTC/USDT")
order_logger.info("Создание ордера")
```

### Логирование операций

Для логирования важных бизнес-операций используйте специальные декораторы:

```python
from src.utils import log_operation, log_async_operation

# Для обычных функций
@log_operation(operation_type="trade", market="BTC/USDT")
def execute_trade(amount, price):
    # Ваш код здесь
    pass

# Для асинхронных функций
@log_async_operation(operation_type="arbitrage", pair="BTC/USDT", exchanges=["binance", "kucoin"])
async def execute_arbitrage(buy_exchange, sell_exchange, amount):
    # Ваш асинхронный код здесь
    pass
```

### Измерение времени выполнения

Для автоматического логирования времени выполнения функций:

```python
from src.utils import log_execution_time, log_async_execution_time

# Для обычных функций
@log_execution_time
def process_data(data):
    # Ваш код здесь
    pass

# Для асинхронных функций
@log_async_execution_time
async def fetch_data():
    # Ваш асинхронный код здесь
    pass
```

### Структурированное логирование

Для логирования структурированных данных используйте операционный логгер:

```python
from src.utils import get_operation_logger

operations_logger = get_operation_logger()

# Логируем структурированные данные в JSON формате
operations_logger.info({
    "event": "balance_update",
    "currency": "BTC",
    "previous_balance": 1.25,
    "new_balance": 1.35,
    "change": 0.1,
    "source": "deposit"
})
```

### Обработка исключений

Для правильного логирования исключений:

```python
logger = get_logger(__name__)

try:
    # Код, который может вызвать исключение
    result = api.fetch_data()
except Exception as e:
    # Записывает сообщение и полный стек-трейс
    logger.exception(f"Ошибка при получении данных: {str(e)}")
    # Можно также добавить raise, если нужно пробросить исключение дальше
```

## Рекомендации

1. **Используйте правильные уровни логирования**:
   - `DEBUG`: детальная отладочная информация
   - `INFO`: общие информационные сообщения
   - `WARNING`: предупреждения, которые не мешают работе
   - `ERROR`: ошибки, которые мешают выполнению операции
   - `CRITICAL`: критические ошибки, требующие немедленного внимания

2. **Добавляйте контекст**:
   - Всегда включайте достаточно информации, чтобы понять, что произошло
   - Для операций добавляйте идентификаторы, биржи, валютные пары и другие важные параметры

3. **Используйте декораторы**:
   - Декораторы обеспечивают единообразное логирование
   - Они также автоматически обрабатывают исключения

4. **Следите за производительностью**:
   - Логирование может влиять на производительность
   - Не логируйте слишком много в продакшн-режиме
   - Используйте условную проверку перед созданием тяжелых сообщений: `if logger.isEnabledFor(logging.DEBUG): logger.debug("Тяжелое сообщение")`

## Примеры

Полные примеры использования системы логирования можно найти в файле `examples/logging_example.py`.
